<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="it"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Controller.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">GC18</a> &gt; <a href="index.source.html" class="el_package">it.polimi.ingsw.controller</a> &gt; <span class="el_source">Controller.java</span></div><h1>Controller.java</h1><pre class="source lang-java linenums">package it.polimi.ingsw.controller;

import it.polimi.ingsw.model.*;
import it.polimi.ingsw.model.enumeration.Colour;
import it.polimi.ingsw.model.enumeration.GamePhase;
import it.polimi.ingsw.model.gameboard.characters.*;
import it.polimi.ingsw.model.gameboard.characters.CharacterCard;
import it.polimi.ingsw.model.gameboard.Cloud;
import it.polimi.ingsw.model.gameboard.GameBoard;
import it.polimi.ingsw.model.player.*;
import it.polimi.ingsw.observer.Observer;
import it.polimi.ingsw.utils.gameMessage;

import java.util.ArrayList;

/*
 *  In this class we manage the main actions of the match.
 */

<span class="fc" id="L20">public class Controller implements Observer&lt;PlayerMove&gt; {</span>

    private Model model;

    private synchronized void performMove(PlayerMove move){
<span class="nc bnc" id="L25" title="All 2 branches missed.">        if(getCurrentPlayer() != move.getPlayer().getIndex()){</span>
<span class="nc" id="L26">            move.getView().reportError(gameMessage.wrongTurnMessage);</span>
<span class="nc" id="L27">            return;</span>
        }
        //System.out.println(&quot;sei in performove &quot; + move.getParam1() + &quot; &quot; + move.getParam2() + &quot; &quot; +  move.getParam3() + &quot; &quot; +  move.getParam4() + &quot; &quot; +  move.getParam5() + &quot; &quot; +  move.getParam6() + &quot; &quot; +  move.getParam7() + &quot; &quot; +  move.getParam8());

<span class="nc" id="L31">        int result = 0;</span>
<span class="nc bnc" id="L32" title="All 7 branches missed.">        switch (move.getParam1()){</span>
            case 0: {
<span class="nc" id="L34">                result = playAssistantCard(move.getPlayer().getIndex(), move.getParam2());</span>
<span class="nc" id="L35">                break;</span>
            }

            case 1: {
<span class="nc bnc" id="L39" title="All 2 branches missed.">                if(move.getParam3() == -1)</span>
<span class="nc" id="L40">                    result = moveStudentToDiningRoom(move.getPlayer().getIndex(), move.getParam2());</span>
                else
<span class="nc" id="L42">                    result = moveStudentToIsland(move.getPlayer().getIndex(), move.getParam2(), move.getParam3());</span>

<span class="nc" id="L44">                break;</span>
            }

            case 2: {
<span class="nc" id="L48">                result = moveMotherNature(move.getPlayer().getIndex(), move.getParam2());</span>
<span class="nc" id="L49">                break;</span>
            }

            case 3: {
<span class="nc" id="L53">                result = chooseCloud(move.getPlayer().getIndex(), move.getParam2());</span>
<span class="nc" id="L54">                break;</span>
            }

            case 5: { //da valutarne il senso
<span class="nc" id="L58">                String winner = getTheWinner();</span>
<span class="nc" id="L59">                System.out.println(winner + &quot;WON THE GAME!\n\n&quot;);</span>
<span class="nc" id="L60">                return;</span>
            }

            case 100: {
<span class="nc bnc" id="L64" title="All 2 branches missed.">                if(!Parameters.expertMode){</span>
<span class="nc" id="L65">                    move.getView().reportError(gameMessage.invalidMoveMessage);</span>
<span class="nc" id="L66">                    return;</span>
                }

<span class="nc bnc" id="L69" title="All 2 branches missed.">                if(move.getParam2() == 1){</span>
<span class="nc" id="L70">                    result = playCharacterCard1(move.getPlayer().getIndex(), move.getParam2(), move.getParam3(), move.getParam4());</span>
<span class="nc bnc" id="L71" title="All 2 branches missed.">                } else if(move.getParam2() == 2){</span>
<span class="nc" id="L72">                    result = playCharacterCard2(move.getPlayer().getIndex(), move.getParam2());</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">                } else if(move.getParam2() == 3){</span>
<span class="nc" id="L74">                    result = playCharacterCard3(move.getPlayer().getIndex(), move.getParam2(), move.getParam3());</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">                } else if(move.getParam2() == 4){</span>
<span class="nc" id="L76">                    result = playCharacterCard4(move.getPlayer().getIndex(), move.getParam2());</span>
<span class="nc bnc" id="L77" title="All 2 branches missed.">                } else if(move.getParam2() == 5){</span>
<span class="nc" id="L78">                    result = playCharacterCard5(move.getPlayer().getIndex(), move.getParam2(), move.getParam3());</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">                } else if(move.getParam2() == 6){</span>
<span class="nc" id="L80">                    result = playCharacterCard6(move.getPlayer().getIndex(), move.getParam2());</span>
<span class="nc bnc" id="L81" title="All 2 branches missed.">                } else if(move.getParam2() == 7){</span>
<span class="nc bnc" id="L82" title="All 2 branches missed.">                    if(move.getParam5() == -1)</span>
<span class="nc" id="L83">                        result = playCharacterCard7(move.getPlayer().getIndex(), move.getParam2(), move.getParam3(), move.getParam4());</span>
<span class="nc bnc" id="L84" title="All 2 branches missed.">                    else if(move.getParam7() == -1)</span>
<span class="nc" id="L85">                        result = playCharacterCard7(move.getPlayer().getIndex(), move.getParam2(), move.getParam3(), move.getParam4(), move.getParam5(), move.getParam6());</span>
                    else
<span class="nc" id="L87">                        result = playCharacterCard7(move.getPlayer().getIndex(), move.getParam2(), move.getParam3(), move.getParam4(), move.getParam5(), move.getParam6(), move.getParam7(), move.getParam8());</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">                } else if(move.getParam2() == 8){</span>
<span class="nc" id="L89">                    result = playCharacterCard8(move.getPlayer().getIndex(), move.getParam2());</span>
<span class="nc bnc" id="L90" title="All 2 branches missed.">                } else if(move.getParam2() == 9){</span>
<span class="nc" id="L91">                    result = playCharacterCard9(move.getPlayer().getIndex(), move.getParam2(), move.getParam3());</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">                } else if(move.getParam2() == 10){</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">                    if(move.getParam5() == -1)</span>
<span class="nc" id="L94">                        result = playCharacterCard10(move.getPlayer().getIndex(), move.getParam2(), move.getParam3(), move.getParam4());</span>
                    else
<span class="nc" id="L96">                        result = playCharacterCard10(move.getPlayer().getIndex(), move.getParam2(), move.getParam3(), move.getParam4(), move.getParam5(), move.getParam6());</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">                } else if(move.getParam2() == 11){</span>
<span class="nc" id="L98">                    result = playCharacterCard11(move.getPlayer().getIndex(), move.getParam2(), move.getParam3());</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">                } else if(move.getParam2() == 12){</span>
<span class="nc" id="L100">                    result = playCharacterCard12(move.getPlayer().getIndex(), move.getParam2(), move.getParam3());</span>
                }
                break;
            }
        }
<span class="nc bnc" id="L105" title="All 2 branches missed.">        if(result == 1)</span>
<span class="nc" id="L106">           model.performMove(move.getPlayer());</span>
        else
<span class="nc" id="L108">            move.getView().reportError(gameMessage.invalidMoveMessage);</span>
<span class="nc" id="L109">    }</span>

    @Override
    public void update(PlayerMove message) {
<span class="nc" id="L113">        performMove(message);</span>
<span class="nc" id="L114">    }</span>


    //Gets the players of the match
    public ArrayList&lt;Player&gt; getPlayers() {
<span class="fc" id="L119">        return model.getPlayers();</span>
    }

    //Gets the gameBoard instance
    public GameBoard getGameBoard() {
<span class="fc" id="L124">        return model.getGameBoard();</span>
    }

    public void setParameters(int numPlayers, Boolean expertMode){
<span class="fc" id="L128">        Parameters.setParameters(numPlayers, expertMode);</span>
<span class="fc" id="L129">        this.model = new Model();</span>
<span class="fc" id="L130">    }</span>


    public int addPlayer(Player player){

<span class="fc bfc" id="L135" title="All 2 branches covered.">        if(model.getPlayers().size() &lt; Parameters.numPlayers) {</span>
<span class="fc" id="L136">            model.getPlayers().add(player);</span>
<span class="fc" id="L137">            return model.getPlayers().size()-1;</span>
        }
        else{
            //qui bisogna mettere una exception che nella partita ci sono già 4 giocatori
<span class="fc" id="L141">            return -1;</span>
        }
    }

    public void init(){   //sto seguendo l'inizializzazione della partita
<span class="fc" id="L146">        double casual = Math.random()*12; //(PUNTO 2)</span>
<span class="fc" id="L147">        int mn = (int) casual;</span>
<span class="fc" id="L148">        model.setModelParameters(Parameters.numPlayers, Parameters.expertMode);</span>

<span class="fc" id="L150">        model.getGameBoard().setMotherNature(mn);  //posiziono madrenatura</span>

<span class="fc" id="L152">        ArrayList&lt;Student&gt; arr = new ArrayList&lt;&gt;();  //(PUNTO 3) creo studenti per le isole</span>
<span class="fc bfc" id="L153" title="All 2 branches covered.">        for (Colour c : Colour.values()) {</span>
<span class="fc bfc" id="L154" title="All 2 branches covered.">            for(int i=0;i&lt;2;i++){</span>
<span class="fc" id="L155">                Student s = new Student(c);</span>
<span class="fc" id="L156">                arr.add(s);</span>
            }
        }
<span class="fc" id="L159">        model.getGameBoard().getBag().fill(arr);</span>

<span class="fc bfc" id="L161" title="All 2 branches covered.">        for (int i=0; i&lt;12; i++){</span>
<span class="fc bfc" id="L162" title="All 4 branches covered.">            if(i != model.getGameBoard().getMotherNature() &amp;&amp; i != (model.getGameBoard().getMotherNature() + 6)%12) //doesn't place students on the island with mothernature and the opposite one</span>
<span class="fc" id="L163">                model.getGameBoard().addStudentOnIsland(i, model.getGameBoard().getBag().draw());</span>

        }

<span class="fc bfc" id="L167" title="All 2 branches covered.">        for (Colour c : Colour.values()) {  //creo gli studenti per il sacchetto</span>
<span class="fc bfc" id="L168" title="All 2 branches covered.">            for(int i=0;i&lt;24;i++){</span>
<span class="fc" id="L169">                Student s = new Student(c);</span>
<span class="fc" id="L170">                arr.add(s);</span>
            }
        }
<span class="fc" id="L173">        model.getGameBoard().getBag().fill(arr);</span>

<span class="fc bfc" id="L175" title="All 2 branches covered.">        for (Player p: model.getPlayers()){</span>
<span class="fc bfc" id="L176" title="All 2 branches covered.">            for (int i=0; i&lt;Parameters.entranceStudents; i++)</span>
<span class="fc" id="L177">                p.getPlayerSchoolBoard().getStudentsEntrance().add(model.getGameBoard().getBag().draw());</span>
<span class="fc" id="L178">        }</span>

<span class="pc bpc" id="L180" title="1 of 2 branches missed.">        if(Parameters.expertMode){</span>
<span class="fc" id="L181">            model.getGameBoard().chooseThreeCards();</span>
        }

<span class="fc" id="L184">        model.setCurrentPlayer(0);</span>
<span class="fc bfc" id="L185" title="All 2 branches covered.">        for(int i = 0; i&lt;Parameters.numPlayers; i++){</span>
<span class="fc" id="L186">            model.getPlayersTurnOrder()[i] = model.getPlayers().get(i);</span>
        }

<span class="fc" id="L189">        addStudentsOnClouds();</span>

<span class="fc" id="L191">        model.setCurrentPhase(GamePhase.PlayAssistantCard);</span>
<span class="fc" id="L192">    }</span>


    //Fase pianificazione punto 1
    private void addStudentsOnClouds(){
<span class="fc" id="L197">        int num = 0;</span>
<span class="fc bfc" id="L198" title="All 2 branches covered.">        for(Cloud c: model.getGameBoard().getClouds()){</span>
<span class="fc bfc" id="L199" title="All 2 branches covered.">            for (int i = 0; i &lt; Parameters.numCloudStudents; i++)</span>
<span class="pc bpc" id="L200" title="1 of 2 branches missed.">                if(model.getGameBoard().getBag().getSize() &gt; 0)</span>
<span class="fc" id="L201">                    model.getGameBoard().addStudentOnCloud(num, model.getGameBoard().getBag().draw());</span>
<span class="fc" id="L202">            num++;</span>
<span class="fc" id="L203">            c.setTaken(false);</span>
<span class="fc" id="L204">        }</span>
<span class="fc" id="L205">    }</span>
    //Fase pianificazione punto 2
    public int playAssistantCard(int playerIndex, int priority){
<span class="pc bpc" id="L208" title="3 of 8 branches missed.">        if(model.getCurrentPhase().equals(GamePhase.PlayAssistantCard) &amp;&amp; playerIndex == model.getCurrentPlayer() &amp;&amp; priority &gt; 0 &amp;&amp; priority &lt;= 10) {</span>
<span class="fc" id="L209">            boolean alreadyPlayed = false;</span>
<span class="fc bfc" id="L210" title="All 2 branches covered.">            for(int i=0; i&lt;model.getPhaseCounter(); i++) {</span>
<span class="fc bfc" id="L211" title="All 2 branches covered.">                if (priority == model.getPlayersTurnOrder()[i].getCurrentCard().getValue()) {</span>
<span class="fc" id="L212">                    alreadyPlayed = true;</span>
<span class="fc" id="L213">                    break;</span>
                }
            }
<span class="fc bfc" id="L216" title="All 2 branches covered.">            if(alreadyPlayed) {</span>
<span class="fc" id="L217">                int check = 0;</span>
<span class="fc bfc" id="L218" title="All 2 branches covered.">                for (AssistantCard as : model.getPlayers().get(playerIndex).getAssistantDeck()) {</span>
<span class="fc bfc" id="L219" title="All 2 branches covered.">                    for (int i = 0; i &lt; model.getPhaseCounter(); i++) {</span>
<span class="fc bfc" id="L220" title="All 2 branches covered.">                        if (as.getValue() == model.getPlayersTurnOrder()[i].getCurrentCard().getValue()) {</span>
<span class="fc" id="L221">                            check++;</span>
                        }
                    }
<span class="fc" id="L224">                }</span>

<span class="pc bpc" id="L226" title="1 of 2 branches missed.">                if (check != model.getPlayers().get(playerIndex).getAssistantDeck().size())</span>
<span class="fc" id="L227">                    return -1;</span>
            }

<span class="fc" id="L230">            boolean found = false;</span>
<span class="fc" id="L231">            ArrayList&lt;AssistantCard&gt; clone = (ArrayList&lt;AssistantCard&gt;) model.getPlayers().get(playerIndex).getAssistantDeck().clone();</span>
<span class="fc bfc" id="L232" title="All 2 branches covered.">            for (AssistantCard as : clone)</span>
<span class="fc bfc" id="L233" title="All 2 branches covered.">                if (as.getValue() == priority){</span>
<span class="fc" id="L234">                    model.getPlayers().get(playerIndex).playAssistantCard(as);//QUI ERRORE CUNCURRENT!!!!</span>

<span class="fc" id="L236">                    found = true;</span>
<span class="fc" id="L237">                    break;</span>
                }

<span class="fc bfc" id="L240" title="All 2 branches covered.">            if(found == false) return -1; //non ha la carta, non ha senso proseguire, tocca ancora lui</span>
<span class="fc bfc" id="L241" title="All 2 branches covered.">            if(model.getPhaseCounter() &lt; Parameters.numPlayers-1) {   //AGGIUNTA GIUS ALTRIMENTI SFORA LA DIMENSIONE DELL'ARRAY</span>
<span class="fc" id="L242">                model.setCurrentPlayer(model.getPlayersTurnOrder()[model.getPhaseCounter() + 1].getIndex());</span>

            }
<span class="fc" id="L245">            model.setPhaseCounter(model.getPhaseCounter() + 1);</span>
<span class="fc bfc" id="L246" title="All 2 branches covered.">            if (model.getPhaseCounter() == Parameters.numPlayers) {</span>
<span class="fc" id="L247">                model.setCurrentPhase(GamePhase.MoveStudents);</span>
<span class="fc" id="L248">                model.setPhaseCounter(0);</span>
<span class="fc" id="L249">                this.orderPlayerActionPhase();</span>
<span class="fc" id="L250">                model.setCurrentPlayer(model.getPlayersTurnOrder()[0].getIndex());</span>

            }
<span class="fc" id="L253">            return 1;</span>
        }
<span class="fc" id="L255">        else return -1;</span>
    }

    private void orderPlayerActionPhase(){  // con algoritmo bubble sort
<span class="pc bpc" id="L259" title="1 of 2 branches missed.">        for(int i = 0; i &lt; model.getPlayersTurnOrder().length; i++){</span>
<span class="fc" id="L260">            boolean swap = false;</span>
<span class="fc bfc" id="L261" title="All 2 branches covered.">            for(int j = 0; j &lt; model.getPlayersTurnOrder().length-1; j++){</span>
<span class="fc bfc" id="L262" title="All 2 branches covered.">                if(model.getPlayersTurnOrder()[j].getCurrentCard().getValue() &gt; model.getPlayersTurnOrder()[j+1].getCurrentCard().getValue()) {</span>
<span class="fc" id="L263">                    Player k = model.getPlayersTurnOrder()[j];</span>
<span class="fc" id="L264">                    model.getPlayersTurnOrder()[j] = model.getPlayersTurnOrder()[j+1];</span>
<span class="fc" id="L265">                    model.getPlayersTurnOrder()[j+1] = k;</span>
<span class="fc" id="L266">                    swap = true; //segna che è avvenuto uno scambio</span>
                }
            }
<span class="fc bfc" id="L269" title="All 2 branches covered.">            if(!swap) break; // esce prima se ha già ordinato tutto</span>
        }
<span class="fc" id="L271">    }</span>

    //Fase azione punto 1
    public int moveStudentToIsland(int playerIndex, int colour, int IslandPosition){

<span class="fc" id="L276">        boolean checkStudentColor = false; // vedo se ha lo studente di quel colore</span>
<span class="fc bfc" id="L277" title="All 2 branches covered.">        for(Student s: model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getStudentsEntrance())</span>
<span class="fc bfc" id="L278" title="All 2 branches covered.">            if(Colour.values()[colour] == s.getColour())</span>
<span class="fc" id="L279">                checkStudentColor = true;</span>

<span class="pc bpc" id="L281" title="7 of 14 branches missed.">        if(model.getCurrentPhase().equals(GamePhase.MoveStudents) &amp;&amp; playerIndex == model.getCurrentPlayer() &amp;&amp; checkStudentColor &amp;&amp; colour &gt;= 0 &amp;&amp; colour &lt; Colour.values().length &amp;&amp; IslandPosition &gt;= 0 &amp;&amp; IslandPosition &lt; model.getGameBoard().getIslands().size()){</span>
<span class="fc" id="L282">            model.getPlayers().get(playerIndex).getPlayerSchoolBoard().moveStudentToIsland(colour, model.getGameBoard().getIslands().get(IslandPosition));</span>

<span class="fc" id="L284">            model.setPhaseCounter(model.getPhaseCounter() + 1);</span>
<span class="pc bpc" id="L285" title="1 of 2 branches missed.">            if(model.getPhaseCounter() == Parameters.numCloudStudents){</span>
<span class="fc" id="L286">                model.setCurrentPhase(GamePhase.MoveMotherNature);</span>
<span class="fc" id="L287">                model.setPhaseCounter(0);</span>
            }
<span class="fc" id="L289">            return 1;</span>
        }
<span class="nc" id="L291">        else return -1;</span>
    }
    //Fase azione punto 1
    public int moveStudentToDiningRoom(int playerIndex, int colour){
<span class="pc bpc" id="L295" title="5 of 10 branches missed.">        if (model.getCurrentPhase().equals(GamePhase.MoveStudents) &amp;&amp; playerIndex == model.getCurrentPlayer() &amp;&amp; colour &gt;= 0 &amp;&amp; colour &lt; Colour.values().length &amp;&amp; model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getDiningRoom().numOfStudentByColor(Colour.values()[colour]) &lt; 10){</span>

<span class="fc" id="L297">            boolean checkStudentColor = false; // vedo se ha lo studente di quel colore</span>
<span class="fc bfc" id="L298" title="All 2 branches covered.">            for (Student s : model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getStudentsEntrance())</span>
<span class="fc bfc" id="L299" title="All 2 branches covered.">                if (Colour.values()[colour] == s.getColour())</span>
<span class="fc" id="L300">                    checkStudentColor = true;</span>

<span class="pc bpc" id="L302" title="1 of 2 branches missed.">            if(checkStudentColor){</span>
                boolean coin; //ritorna true se il giocatore merita una moneta
<span class="fc" id="L304">                coin = model.getPlayers().get(playerIndex).getPlayerSchoolBoard().moveStudentToDiningRoom(colour);</span>
<span class="pc bpc" id="L305" title="2 of 4 branches missed.">                if (Parameters.expertMode &amp;&amp; coin)</span>
<span class="nc bnc" id="L306" title="All 2 branches missed.">                    if(model.getGameBoard().getOneCoin())</span>
<span class="nc" id="L307">                        model.getPlayers().get(playerIndex).addCoin();</span>

                //controllo chi possiede il professore ora
<span class="fc" id="L310">                checkProfessorProperty(colour);</span>

<span class="fc" id="L312">                model.setPhaseCounter(model.getPhaseCounter() + 1);</span>
<span class="pc bpc" id="L313" title="1 of 2 branches missed.">                if (model.getPhaseCounter()  == Parameters.numCloudStudents) {</span>
<span class="nc" id="L314">                    model.setCurrentPhase(GamePhase.MoveMotherNature);</span>
<span class="nc" id="L315">                    model.setPhaseCounter(0);</span>
                }

<span class="fc" id="L318">                return 1;</span>
<span class="nc" id="L319">            } else return -1;</span>
<span class="nc" id="L320">        } else return -1;</span>
    }
    private void checkProfessorProperty(int colorIndex){
<span class="fc" id="L323">        Player oldProfessorOwner = null;</span>
<span class="fc bfc" id="L324" title="All 2 branches covered.">        for (Player p : model.getPlayers())  //vedo chi aveva il professore prima</span>
<span class="fc bfc" id="L325" title="All 2 branches covered.">            for (Professor pr : p.getPlayerSchoolBoard().getProfessors())</span>
<span class="fc bfc" id="L326" title="All 2 branches covered.">                if (pr.getProfessorColour().equals(Colour.values()[colorIndex])){</span>
<span class="fc" id="L327">                    oldProfessorOwner = p;</span>
<span class="fc" id="L328">                    break;</span>
                }

<span class="fc" id="L331">        ArrayList&lt;Player&gt; rank = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L332">        int max = 0;</span>
<span class="fc bfc" id="L333" title="All 2 branches covered.">        for (Player p : model.getPlayers()){  //trovo il giocatore con più studenti</span>
<span class="fc bfc" id="L334" title="All 2 branches covered.">            if(max &lt; p.getPlayerSchoolBoard().getDiningRoom().numOfStudentByColor(Colour.values()[colorIndex])){</span>
<span class="fc" id="L335">                max = p.getPlayerSchoolBoard().getDiningRoom().numOfStudentByColor(Colour.values()[colorIndex]);</span>
<span class="fc" id="L336">                rank.clear();</span>
<span class="fc" id="L337">                rank.add(p);</span>
<span class="fc bfc" id="L338" title="All 4 branches covered.">            }else if (max == p.getPlayerSchoolBoard().getDiningRoom().numOfStudentByColor(Colour.values()[colorIndex]) &amp;&amp; max != 0){  //qui ho parità</span>
<span class="fc" id="L339">                rank.add(p);</span>
            }
<span class="fc" id="L341">        }</span>

<span class="fc bfc" id="L343" title="All 2 branches covered.">        if(rank.size() == 1){</span>
<span class="fc bfc" id="L344" title="All 2 branches covered.">            if(oldProfessorOwner == null){</span>
<span class="fc" id="L345">                rank.get(0).getPlayerSchoolBoard().addProfessor(Colour.values()[colorIndex]);</span>
<span class="fc bfc" id="L346" title="All 2 branches covered.">            } else if(!oldProfessorOwner.equals(rank.get(0))){</span>
<span class="fc" id="L347">                oldProfessorOwner.getPlayerSchoolBoard().removeProfessor(Colour.values()[colorIndex]);</span>
<span class="fc" id="L348">                rank.get(0).getPlayerSchoolBoard().addProfessor(Colour.values()[colorIndex]);</span>
            }
        }
<span class="fc" id="L351">    }</span>

    //Fase azione punto 2.1
    public int moveMotherNature(int playerIndex, int movements){ //devo controllare se player ha i permessi
<span class="pc bpc" id="L355" title="1 of 4 branches missed.">        if(model.getCurrentPhase().equals(GamePhase.MoveMotherNature) &amp;&amp; playerIndex == model.getCurrentPlayer()){</span>
<span class="fc" id="L356">            int maxMovements = model.getPlayers().get(model.getCurrentPlayer()).getCurrentCard().getMovements();</span>
<span class="pc bpc" id="L357" title="2 of 4 branches missed.">            if(Parameters.expertMode &amp;&amp; movements &lt;= maxMovements+2){</span>
<span class="fc bfc" id="L358" title="All 2 branches covered.">                for(CharacterCard c: model.getGameBoard().getThreeCharacterCards())</span>
<span class="pc bpc" id="L359" title="3 of 4 branches missed.">                    if(c.getIndex() == 4 &amp;&amp; ((Character4) c).isEffectFlag()){</span>
<span class="nc" id="L360">                        maxMovements += 2;</span>
<span class="nc" id="L361">                        ((Character4) c).disableEffect();</span>
                    }
            }
<span class="pc bpc" id="L364" title="1 of 4 branches missed.">            if(movements &gt; 0 &amp;&amp; movements &lt;= maxMovements){</span>
<span class="fc" id="L365">                int newPos = (model.getGameBoard().getMotherNature() + movements)%model.getGameBoard().getIslands().size();</span>
<span class="fc" id="L366">                model.getGameBoard().setMotherNature(newPos);//moves motherNature by specified movements</span>
<span class="fc" id="L367">                System.out.println(&quot;stai per entrare in checkInfluence&quot;);</span>
<span class="fc" id="L368">                this.checkIslandInfluence(newPos, playerIndex);</span>
<span class="fc" id="L369">            } else return -1;</span>

<span class="pc bpc" id="L371" title="1 of 2 branches missed.">            if(!model.getCurrentPhase().equals(GamePhase.GameEnded))</span>
<span class="fc" id="L372">                model.setCurrentPhase(GamePhase.ChooseCloud);</span>

<span class="fc" id="L374">            return 1;</span>
        }
<span class="fc" id="L376">        else return -1;</span>
    }

    //Fase azione punto 2.2 //vedo chi controlla l'isola, se il player è cambiato sostituisco le torri
    private void checkIslandInfluence(int islandIndex, int playerIndex){
<span class="fc" id="L381">        boolean card6noTowerFlag = false;</span>
<span class="fc" id="L382">        int card9color = -1;</span>
<span class="fc" id="L383">        int card8twoMorePointsPlayer = -1;</span>
<span class="pc bpc" id="L384" title="1 of 2 branches missed.">        if(Parameters.expertMode){</span>
<span class="fc bfc" id="L385" title="All 2 branches covered.">            for(CharacterCard c: model.getGameBoard().getThreeCharacterCards())</span>
<span class="pc bpc" id="L386" title="3 of 4 branches missed.">                if(c.getIndex() == 5 &amp;&amp; model.getGameBoard().getIslands().get(islandIndex).getNoEntry() &gt; 0){</span>
<span class="nc" id="L387">                    model.getGameBoard().getIslands().get(islandIndex).removeNoEntry();</span>
<span class="nc" id="L388">                    ((Character5) c).addNoEntry();</span>
<span class="nc" id="L389">                    return;  // proseguo come se madre natura non fosse capitata qui</span>
<span class="pc bpc" id="L390" title="3 of 4 branches missed.">                } else if(c.getIndex() == 6 &amp;&amp; ((Character6) c).isEffectFlag()){</span>
<span class="nc" id="L391">                    ((Character6) c).disableEffect();</span>
<span class="nc" id="L392">                    card6noTowerFlag = true;</span>
<span class="pc bpc" id="L393" title="3 of 4 branches missed.">                } else if(c.getIndex() == 8 &amp;&amp; ((Character8) c).isEffectFlag()){</span>
<span class="nc" id="L394">                    ((Character8) c).disableEffect();</span>
<span class="nc" id="L395">                    card8twoMorePointsPlayer = playerIndex;</span>
<span class="pc bpc" id="L396" title="1 of 4 branches missed.">                } else if(c.getIndex() == 9 &amp;&amp; ((Character9) c).isEffectFlag()){</span>
<span class="nc" id="L397">                    ((Character9) c).disableEffect();</span>
<span class="nc" id="L398">                    card9color = ((Character9) c).getColor();</span>
                }

        }
        // vedo chi ha più influenza ora
<span class="fc" id="L403">        Player newPlayer = model.getGameBoard().getIslands().get(islandIndex).Influence(model.getPlayers(), card6noTowerFlag, card8twoMorePointsPlayer, card9color);</span>

<span class="fc bfc" id="L405" title="All 2 branches covered.">        if (newPlayer!=null){</span>
<span class="fc" id="L406">            Player oldPlayer = null;  // vedo chi controllava l'isola prima</span>
<span class="fc bfc" id="L407" title="All 2 branches covered.">            for (Player pl: model.getPlayers()){</span>
<span class="pc bpc" id="L408" title="1 of 2 branches missed.">                if(pl.PlayerTowerColor().equals(model.getGameBoard().getIslands().get(islandIndex).getTowerColor()))</span>
<span class="nc" id="L409">                    oldPlayer = pl;</span>
<span class="fc" id="L410">            }</span>

<span class="pc bpc" id="L412" title="3 of 4 branches missed.">            if(oldPlayer == null || !oldPlayer.equals(newPlayer)){</span>
                //ridò al vecchio giocatore le sue torri e le sostituisco con quelle del nuovo giocatore
<span class="fc bfc" id="L414" title="All 2 branches covered.">                for(int i=0; i&lt;=model.getGameBoard().getIslands().get(islandIndex).getNumTower(); i++){</span>
<span class="pc bpc" id="L415" title="1 of 2 branches missed.">                    if(oldPlayer != null)</span>
<span class="nc" id="L416">                        oldPlayer.getPlayerSchoolBoard().addTower(oldPlayer.PlayerTowerColor());</span>
<span class="fc" id="L417">                    newPlayer.getPlayerSchoolBoard().getTowers().remove(0);</span>
                }
<span class="pc bpc" id="L419" title="1 of 2 branches missed.">                if(oldPlayer == null){</span>
<span class="fc" id="L420">                    this.getGameBoard().getIslands().get(islandIndex).setNumTower(1);</span>
                }

<span class="fc" id="L423">                this.getGameBoard().getIslands().get(islandIndex).changeTowerColor(newPlayer.PlayerTowerColor());</span>

<span class="pc bpc" id="L425" title="1 of 2 branches missed.">                if(newPlayer.getPlayerSchoolBoard().getTowers().size() &lt; 1){</span>
<span class="nc" id="L426">                    model.setWinner(newPlayer);</span>
<span class="nc" id="L427">                    model.setCurrentPhase(GamePhase.GameEnded);</span>
<span class="nc" id="L428">                    return;</span>
                }

<span class="fc" id="L431">                checkIslandFusion(islandIndex);</span>
            }
        }
        //se nessuno ha l'influenza o in caso di parità non succede nulla
<span class="fc" id="L435">    }</span>
    //Fase azione punto 2.3
    private void checkIslandFusion(int islandIndex){
        //se il colore delle torri sull'isola e su quella successiva sono uguali
<span class="pc bpc" id="L439" title="1 of 2 branches missed.">        while (model.getGameBoard().getIslands().get(islandIndex).getTowerColor().equals(model.getGameBoard().getIslands().get((islandIndex+1)%model.getGameBoard().getIslands().size()).getTowerColor())){</span>
<span class="nc bnc" id="L440" title="All 2 branches missed.">            if(Parameters.expertMode) {</span>
<span class="nc bnc" id="L441" title="All 2 branches missed.">                for (CharacterCard c : model.getGameBoard().getThreeCharacterCards())</span>
<span class="nc bnc" id="L442" title="All 6 branches missed.">                    if (c.getIndex() == 3 &amp;&amp; ((Character3) c).isEffectFlag() &amp;&amp; model.getGameBoard().getMotherNature() &gt;= (islandIndex + 1) % model.getGameBoard().getIslands().size()) {</span>
<span class="nc" id="L443">                        int mn = model.getGameBoard().getMotherNature() - 1;</span>
<span class="nc bnc" id="L444" title="All 2 branches missed.">                        if (mn == -1)</span>
<span class="nc" id="L445">                            mn = model.getGameBoard().getIslands().size() - 1;</span>
<span class="nc" id="L446">                        model.getGameBoard().setMotherNature(mn);</span>
                    }
            }
<span class="nc" id="L449">            model.getGameBoard().islandFusion(islandIndex, (islandIndex+1)%model.getGameBoard().getIslands().size());</span>
        }

<span class="fc" id="L452">        int newPosition = islandIndex;</span>
<span class="fc" id="L453">        int newPosition2 = newPosition-1;</span>
<span class="fc bfc" id="L454" title="All 2 branches covered.">        if (newPosition2 == -1)</span>
<span class="fc" id="L455">            newPosition2 = model.getGameBoard().getIslands().size()-1;</span>
        //se il colore delle torri sull'isola e su quella precedente sono uguali
<span class="fc bfc" id="L457" title="All 2 branches covered.">        while (model.getGameBoard().getIslands().get(newPosition).getTowerColor().equals(model.getGameBoard().getIslands().get(newPosition2).getTowerColor())){</span>
<span class="fc" id="L458">            model.getGameBoard().islandFusion(newPosition2, newPosition);</span>

<span class="pc bpc" id="L460" title="1 of 2 branches missed.">            if(!Parameters.expertMode){</span>
<span class="nc bnc" id="L461" title="All 2 branches missed.">                if(newPosition2 == model.getGameBoard().getIslands().size())</span>
<span class="nc" id="L462">                    newPosition2 = model.getGameBoard().getIslands().size()-1;</span>

<span class="nc" id="L464">                model.getGameBoard().setMotherNature(newPosition2);</span>
            } else {
<span class="fc" id="L466">                boolean card3 = false;</span>
<span class="fc bfc" id="L467" title="All 2 branches covered.">                for(CharacterCard c: model.getGameBoard().getThreeCharacterCards())</span>
<span class="pc bpc" id="L468" title="3 of 4 branches missed.">                    if(c.getIndex() == 3 &amp;&amp; ((Character3) c).isEffectFlag())</span>
<span class="nc" id="L469">                        card3 = true;</span>

<span class="pc bpc" id="L471" title="1 of 2 branches missed.">                if(!card3){</span>
<span class="pc bpc" id="L472" title="1 of 2 branches missed.">                    if(newPosition2 == model.getGameBoard().getIslands().size())</span>
<span class="nc" id="L473">                        newPosition2 = model.getGameBoard().getIslands().size()-1;</span>

<span class="fc" id="L475">                    model.getGameBoard().setMotherNature(newPosition2);</span>
                }
<span class="nc bnc" id="L477" title="All 2 branches missed.">                else if(model.getGameBoard().getMotherNature() &gt;= (newPosition2+1)%(model.getGameBoard().getIslands().size()+1)){</span>
<span class="nc" id="L478">                    int mn = model.getGameBoard().getMotherNature()-1;</span>
<span class="nc bnc" id="L479" title="All 2 branches missed.">                    if(mn == -1)</span>
<span class="nc" id="L480">                        mn = model.getGameBoard().getIslands().size()-1;</span>
<span class="nc" id="L481">                    model.getGameBoard().setMotherNature(mn);</span>
                }
            }

<span class="fc" id="L485">            newPosition--;</span>
<span class="pc bpc" id="L486" title="1 of 2 branches missed.">            if(newPosition == -1)</span>
<span class="nc" id="L487">                newPosition = model.getGameBoard().getIslands().size()-1;</span>
<span class="fc" id="L488">            newPosition2 = newPosition-1;</span>
<span class="pc bpc" id="L489" title="1 of 2 branches missed.">            if (newPosition2 == -1)</span>
<span class="nc" id="L490">                newPosition2 = model.getGameBoard().getIslands().size()-1;</span>
        }

<span class="pc bpc" id="L493" title="1 of 2 branches missed.">        if(model.getGameBoard().getIslands().size() &lt;= 3){</span>
<span class="nc" id="L494">            endGame();</span>
<span class="nc" id="L495">            return;</span>
        }
<span class="fc" id="L497">    }</span>

    //Fase azione punto 3
    public int chooseCloud(int playerIndex, int cloudPosition){
<span class="pc bpc" id="L501" title="2 of 10 branches missed.">        if(model.getCurrentPhase().equals(GamePhase.ChooseCloud) &amp;&amp; playerIndex == model.getCurrentPlayer() &amp;&amp; cloudPosition &gt;= 0 &amp;&amp; cloudPosition &lt; Parameters.numClouds &amp;&amp; !model.getGameBoard().getClouds().get(cloudPosition).isTaken()){</span>
<span class="fc" id="L502">            ArrayList&lt;Student&gt; stud = model.getGameBoard().getClouds().get(cloudPosition).getStudents();</span>

<span class="fc bfc" id="L504" title="All 2 branches covered.">            for (Student s: stud){ //qui e alla fine del metodo init() farei un nuovo metodo add che controlla anche se non viene superato il limite di studenti all'entrata</span>
<span class="fc" id="L505">                model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getStudentsEntrance().add(s);</span>
<span class="fc" id="L506">            }</span>

<span class="pc bpc" id="L508" title="1 of 2 branches missed.">            if(Parameters.expertMode){</span>
<span class="fc bfc" id="L509" title="All 2 branches covered.">                for(CharacterCard c: model.getGameBoard().getThreeCharacterCards())</span>
<span class="pc bpc" id="L510" title="1 of 4 branches missed.">                    if(c.getIndex() == 2 &amp;&amp; ((Character2) c).isEffectFlag()){</span>
<span class="nc" id="L511">                        ((Character2) c).disableEffect();</span>
<span class="nc bnc" id="L512" title="All 2 branches missed.">                        for(int i=0; i&lt;5; i++)</span>
<span class="nc" id="L513">                            checkProfessorProperty(i);</span>
                    }
            }

<span class="fc" id="L517">            model.setPlayerPhaseCounter(model.getPlayerPhaseCounter() + 1);</span>
<span class="fc bfc" id="L518" title="All 2 branches covered.">            if(model.getPlayerPhaseCounter() == Parameters.numPlayers){</span>
<span class="fc" id="L519">                model.setPlayerPhaseCounter(0);</span>
<span class="fc" id="L520">                addStudentsOnClouds();</span>
<span class="fc" id="L521">                orderPlayersAssistantCard();</span>
<span class="fc" id="L522">                model.setCurrentPhase(GamePhase.PlayAssistantCard);</span>


<span class="pc bpc" id="L525" title="1 of 2 branches missed.">                if(model.getGameBoard().getBag().getSize() == 0){//bisogna mettere delle exception dove viene pescato uno studente se non ce ne sono più, poi qui finisco il gioco.</span>
<span class="nc" id="L526">                    endGame();</span>
<span class="nc" id="L527">                    return 1;</span>
                }
<span class="fc bfc" id="L529" title="All 2 branches covered.">                for(Player p: model.getPlayers())</span>
<span class="pc bpc" id="L530" title="1 of 2 branches missed.">                    if(p.getAssistantDeck().size() == 0){</span>
<span class="nc" id="L531">                        endGame();</span>
<span class="nc" id="L532">                        return 1;</span>
                    }

            } else {
<span class="fc" id="L536">                model.setCurrentPhase(GamePhase.MoveStudents);</span>
<span class="fc" id="L537">                model.setCurrentPlayer(model.getPlayersTurnOrder()[model.getPlayerPhaseCounter()].getIndex());</span>
            }
<span class="fc" id="L539">            return 1;</span>
        } else
<span class="fc" id="L541">            return -1;</span>
    }

    private void orderPlayersAssistantCard(){
<span class="fc" id="L545">        int index = -1;</span>
        int num;
<span class="fc" id="L547">        int min = 11;</span>
<span class="fc bfc" id="L548" title="All 2 branches covered.">        for(Player p: model.getPlayers()){</span>
<span class="fc" id="L549">            num = p.getCurrentCard().getValue();</span>
<span class="pc bpc" id="L550" title="1 of 2 branches missed.">            if(num &lt; min){</span>
<span class="fc" id="L551">                min = num;</span>
<span class="fc" id="L552">                index = p.getIndex();</span>
            }
<span class="fc" id="L554">            p.setCurrentCard(new AssistantCard(0, 0));</span>
<span class="fc" id="L555">        }</span>

<span class="fc" id="L557">        model.setCurrentPlayer(index);</span>
<span class="fc bfc" id="L558" title="All 2 branches covered.">        for(int i = 0; i&lt;Parameters.numPlayers; i++)</span>
<span class="fc" id="L559">            model.getPlayersTurnOrder()[i] = model.getPlayers().get((index + i)%Parameters.numPlayers);</span>
<span class="fc" id="L560">    }</span>

    private void endGame(){
        //vince il giocatore che ha costruito il maggior numero di torri
<span class="nc" id="L564">        ArrayList&lt;Player&gt; rank = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L565">        int min = Parameters.numTowers;</span>
<span class="nc bnc" id="L566" title="All 2 branches missed.">        for (Player p: model.getPlayers())</span>
<span class="nc bnc" id="L567" title="All 2 branches missed.">            if(p.getPlayerSchoolBoard().getTowers().size() &lt; min){</span>
<span class="nc" id="L568">                min = p.getPlayerSchoolBoard().getTowers().size();</span>
<span class="nc" id="L569">                rank.clear();</span>
<span class="nc" id="L570">                rank.add(p);</span>
<span class="nc bnc" id="L571" title="All 2 branches missed.">            } else if(p.getPlayerSchoolBoard().getTowers().size() == min)</span>
<span class="nc" id="L572">                rank.add(p);</span>

        //in caso di parità chi ha piu professori
<span class="nc bnc" id="L575" title="All 2 branches missed.">        if(rank.size() == 1)</span>
<span class="nc" id="L576">            model.setWinner(rank.get(0));</span>
        else {
<span class="nc" id="L578">            int max = 0;</span>
<span class="nc bnc" id="L579" title="All 2 branches missed.">            for(Player p: rank)</span>
<span class="nc bnc" id="L580" title="All 2 branches missed.">                if(p.getPlayerSchoolBoard().getProfessors().size() &gt; max){</span>
<span class="nc" id="L581">                    max = p.getPlayerSchoolBoard().getProfessors().size();</span>
<span class="nc" id="L582">                    model.setWinner(p);</span>
                }
        }

<span class="nc" id="L586">        model.setCurrentPhase(GamePhase.GameEnded);</span>
<span class="nc" id="L587">    }</span>

    public String getTheWinner(){
<span class="nc" id="L590">        return model.getWinner().getNickname();</span>
    }

    public int getCurrentPhase() {
<span class="fc" id="L594">        return model.getCurrentPhase().ordinal();</span>
    }

    public int getCurrentPlayer(){
<span class="fc" id="L598">        return model.getCurrentPlayer();</span>
    }

    public Model getModel() {
<span class="nc" id="L602">        return model;</span>
    }



    public int playCharacterCard1(int playerIndex, int cardIndex, int colorIndex, int islandIndex){
<span class="nc bnc" id="L608" title="All 2 branches missed.">        if(playerIndex == model.getCurrentPlayer()){</span>
<span class="nc bnc" id="L609" title="All 2 branches missed.">            for (CharacterCard c: model.getGameBoard().getThreeCharacterCards()){</span>
<span class="nc bnc" id="L610" title="All 6 branches missed.">                if(cardIndex == c.getIndex() &amp;&amp; model.getPlayers().get(playerIndex).getCoins() &gt;= c.getCost() &amp;&amp; ((Character1) c).checkColorExists(colorIndex)){</span>
<span class="nc" id="L611">                    System.out.println(&quot;STAI GIOCANDO LA CARTA 1&quot;);</span>
<span class="nc" id="L612">                    model.getPlayers().get(playerIndex).removeCoin(c.getCost());</span>
<span class="nc" id="L613">                    model.getGameBoard().addCoinsToGeneralReserve(c.getCost() - 1); //meno uno perchè una va sulla carta</span>
<span class="nc" id="L614">                    c.play();</span>

<span class="nc" id="L616">                    model.getGameBoard().addStudentOnIsland(islandIndex, ((Character1) c).getStudent(colorIndex));</span>
<span class="nc" id="L617">                    ((Character1) c).addStudent(model.getGameBoard().getBag().draw());</span>
<span class="nc" id="L618">                    return 1;</span>
                }
<span class="nc" id="L620">            }</span>
        }
<span class="nc" id="L622">        return -1;</span>
    }

    public int playCharacterCard2(int playerIndex, int cardIndex){
<span class="nc bnc" id="L626" title="All 4 branches missed.">        if(playerIndex == model.getCurrentPlayer() &amp;&amp; model.getCurrentPhase().ordinal() &lt;= GamePhase.MoveMotherNature.ordinal()){</span>
<span class="nc bnc" id="L627" title="All 2 branches missed.">            for (CharacterCard c: model.getGameBoard().getThreeCharacterCards()){</span>
<span class="nc bnc" id="L628" title="All 4 branches missed.">                if(cardIndex == c.getIndex() &amp;&amp; model.getPlayers().get(playerIndex).getCoins() &gt;= c.getCost()){</span>
<span class="nc" id="L629">                    System.out.println(&quot;STAI GIOCANDO LA CARTA 2&quot;);</span>
<span class="nc" id="L630">                    model.getPlayers().get(playerIndex).removeCoin(c.getCost());</span>
<span class="nc" id="L631">                    model.getGameBoard().addCoinsToGeneralReserve(c.getCost() - 1);</span>
<span class="nc" id="L632">                    c.play();</span>

<span class="nc" id="L634">                    ((Character2) c).enableEffect();</span>
<span class="nc bnc" id="L635" title="All 2 branches missed.">                    for(int i=0; i&lt;5; i++)</span>
<span class="nc" id="L636">                        checkProfessorPropertyCard2(i);</span>
<span class="nc" id="L637">                    return 1;</span>
                }
<span class="nc" id="L639">            }</span>
        }
<span class="nc" id="L641">        return -1;</span>
    }

    private void checkProfessorPropertyCard2(int colorIndex){
<span class="nc" id="L645">        Player oldProfessorOwner = null;</span>
<span class="nc bnc" id="L646" title="All 2 branches missed.">        for (Player p : model.getPlayers())  //vedo chi aveva il professore prima</span>
<span class="nc bnc" id="L647" title="All 2 branches missed.">            for (Professor pr : p.getPlayerSchoolBoard().getProfessors())</span>
<span class="nc bnc" id="L648" title="All 2 branches missed.">                if (pr.getProfessorColour().equals(Colour.values()[colorIndex])){</span>
<span class="nc" id="L649">                    oldProfessorOwner = p;</span>
<span class="nc" id="L650">                    break;</span>
                }

<span class="nc" id="L653">        ArrayList&lt;Player&gt; rank = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L654">        int max = 0;</span>
<span class="nc bnc" id="L655" title="All 2 branches missed.">        for (Player p : model.getPlayers()){  //trovo il giocatore con più studenti</span>
<span class="nc bnc" id="L656" title="All 2 branches missed.">            if(max &lt; p.getPlayerSchoolBoard().getDiningRoom().numOfStudentByColor(Colour.values()[colorIndex])){</span>
<span class="nc" id="L657">                max = p.getPlayerSchoolBoard().getDiningRoom().numOfStudentByColor(Colour.values()[colorIndex]);</span>
<span class="nc" id="L658">                rank.clear();</span>
<span class="nc" id="L659">                rank.add(p);</span>
<span class="nc bnc" id="L660" title="All 4 branches missed.">            }else if (max == p.getPlayerSchoolBoard().getDiningRoom().numOfStudentByColor(Colour.values()[colorIndex]) &amp;&amp; max != 0){  //qui ho parità</span>
<span class="nc" id="L661">                rank.add(p);</span>
            }
<span class="nc" id="L663">        }</span>

<span class="nc bnc" id="L665" title="All 2 branches missed.">        if(rank.size() == 1){</span>
<span class="nc bnc" id="L666" title="All 2 branches missed.">            if(oldProfessorOwner == null){</span>
<span class="nc" id="L667">                rank.get(0).getPlayerSchoolBoard().addProfessor(Colour.values()[colorIndex]);</span>
<span class="nc bnc" id="L668" title="All 2 branches missed.">            } else if(!oldProfessorOwner.equals(rank.get(0))){</span>

            }
        } else {
<span class="nc bnc" id="L672" title="All 2 branches missed.">            for(Player p: rank)</span>
<span class="nc bnc" id="L673" title="All 2 branches missed.">                if(p.getIndex() == getCurrentPlayer()){</span>
<span class="nc" id="L674">                    oldProfessorOwner.getPlayerSchoolBoard().removeProfessor(Colour.values()[colorIndex]);</span>
<span class="nc" id="L675">                    rank.get(0).getPlayerSchoolBoard().addProfessor(Colour.values()[colorIndex]);</span>
                }
        }
<span class="nc" id="L678">    }</span>

    public int playCharacterCard3(int playerIndex, int cardIndex, int islandIndex){
<span class="nc bnc" id="L681" title="All 2 branches missed.">        if(playerIndex == model.getCurrentPlayer()){</span>
<span class="nc bnc" id="L682" title="All 2 branches missed.">            for (CharacterCard c: model.getGameBoard().getThreeCharacterCards()){</span>
<span class="nc bnc" id="L683" title="All 4 branches missed.">                if(cardIndex == c.getIndex() &amp;&amp; model.getPlayers().get(playerIndex).getCoins() &gt;= c.getCost()){</span>
<span class="nc" id="L684">                    System.out.println(&quot;STAI GIOCANDO LA CARTA 3&quot;);</span>
<span class="nc" id="L685">                    model.getPlayers().get(playerIndex).removeCoin(c.getCost());</span>
<span class="nc" id="L686">                    model.getGameBoard().addCoinsToGeneralReserve(c.getCost() - 1);</span>
<span class="nc" id="L687">                    c.play();</span>

<span class="nc" id="L689">                    ((Character3) c).enableEffect();</span>
<span class="nc" id="L690">                    checkIslandInfluence(islandIndex, playerIndex);</span>
<span class="nc" id="L691">                    ((Character3) c).disableEffect();</span>
<span class="nc" id="L692">                    return 1;</span>
                }
<span class="nc" id="L694">            }</span>
        }
<span class="nc" id="L696">        return -1;</span>
    }

    public int playCharacterCard4(int playerIndex, int cardIndex){
<span class="nc bnc" id="L700" title="All 4 branches missed.">        if(playerIndex == model.getCurrentPlayer() &amp;&amp; model.getCurrentPhase().ordinal() &lt;= GamePhase.MoveMotherNature.ordinal()){</span>
<span class="nc bnc" id="L701" title="All 2 branches missed.">            for (CharacterCard c: model.getGameBoard().getThreeCharacterCards()){</span>
<span class="nc bnc" id="L702" title="All 4 branches missed.">                if(cardIndex == c.getIndex() &amp;&amp; model.getPlayers().get(playerIndex).getCoins() &gt;= c.getCost()){</span>
<span class="nc" id="L703">                    System.out.println(&quot;STAI GIOCANDO LA CARTA 4&quot;);</span>
<span class="nc" id="L704">                    model.getPlayers().get(playerIndex).removeCoin(c.getCost());</span>
<span class="nc" id="L705">                    model.getGameBoard().addCoinsToGeneralReserve(c.getCost() - 1);</span>
<span class="nc" id="L706">                    c.play();</span>

<span class="nc" id="L708">                    ((Character4) c).enableEffect();</span>
<span class="nc" id="L709">                    return 1;</span>
                }
<span class="nc" id="L711">            }</span>
        }
<span class="nc" id="L713">        return -1;</span>
    }

    public int playCharacterCard5(int playerIndex, int cardIndex, int islandIndex){
<span class="nc bnc" id="L717" title="All 2 branches missed.">        if(playerIndex == model.getCurrentPlayer()){</span>
<span class="nc bnc" id="L718" title="All 2 branches missed.">            for (CharacterCard c: model.getGameBoard().getThreeCharacterCards()){</span>
<span class="nc bnc" id="L719" title="All 4 branches missed.">                if(cardIndex == c.getIndex() &amp;&amp; model.getPlayers().get(playerIndex).getCoins() &gt;= c.getCost()){</span>
<span class="nc" id="L720">                    System.out.println(&quot;STAI GIOCANDO LA CARTA 5&quot;);</span>
<span class="nc" id="L721">                    model.getPlayers().get(playerIndex).removeCoin(c.getCost());</span>
<span class="nc" id="L722">                    model.getGameBoard().addCoinsToGeneralReserve(c.getCost() - 1);</span>
<span class="nc" id="L723">                    c.play();</span>

<span class="nc" id="L725">                    model.getGameBoard().getIslands().get(islandIndex).addNoEntry();</span>
<span class="nc" id="L726">                    return 1;</span>
                }
<span class="nc" id="L728">            }</span>
        }
<span class="nc" id="L730">        return -1;</span>
    }

    public int playCharacterCard6(int playerIndex, int cardIndex){
<span class="nc bnc" id="L734" title="All 4 branches missed.">        if(playerIndex == model.getCurrentPlayer() &amp;&amp; model.getCurrentPhase().ordinal() &lt;= GamePhase.MoveMotherNature.ordinal()){</span>
<span class="nc bnc" id="L735" title="All 2 branches missed.">            for (CharacterCard c: model.getGameBoard().getThreeCharacterCards()){</span>
<span class="nc bnc" id="L736" title="All 4 branches missed.">                if(cardIndex == c.getIndex() &amp;&amp; model.getPlayers().get(playerIndex).getCoins() &gt;= c.getCost()){</span>
<span class="nc" id="L737">                    System.out.println(&quot;STAI GIOCANDO LA CARTA 6&quot;);</span>
<span class="nc" id="L738">                    model.getPlayers().get(playerIndex).removeCoin(c.getCost());</span>
<span class="nc" id="L739">                    model.getGameBoard().addCoinsToGeneralReserve(c.getCost() - 1);</span>
<span class="nc" id="L740">                    c.play();</span>

<span class="nc" id="L742">                    ((Character6) c).enableEffect();</span>
<span class="nc" id="L743">                    return 1;</span>
                }
<span class="nc" id="L745">            }</span>
        }
<span class="nc" id="L747">        return -1;</span>
    }

    public int playCharacterCard8(int playerIndex, int cardIndex){
<span class="nc bnc" id="L751" title="All 4 branches missed.">        if(playerIndex == model.getCurrentPlayer() &amp;&amp; model.getCurrentPhase().ordinal() &lt;= GamePhase.MoveMotherNature.ordinal()){</span>
<span class="nc bnc" id="L752" title="All 2 branches missed.">            for (CharacterCard c: model.getGameBoard().getThreeCharacterCards()){</span>
<span class="nc bnc" id="L753" title="All 4 branches missed.">                if(cardIndex == c.getIndex() &amp;&amp; model.getPlayers().get(playerIndex).getCoins() &gt;= c.getCost()){</span>
<span class="nc" id="L754">                    System.out.println(&quot;STAI GIOCANDO LA CARTA 8&quot;);</span>
<span class="nc" id="L755">                    model.getPlayers().get(playerIndex).removeCoin(c.getCost());</span>
<span class="nc" id="L756">                    model.getGameBoard().addCoinsToGeneralReserve(c.getCost() - 1);</span>
<span class="nc" id="L757">                    c.play();</span>

<span class="nc" id="L759">                    ((Character8) c).enableEffect();</span>
<span class="nc" id="L760">                    return 1;</span>
                }
<span class="nc" id="L762">            }</span>
        }
<span class="nc" id="L764">        return -1;</span>
    }

    public int playCharacterCard9(int playerIndex, int cardIndex, int colorIndex){
<span class="nc bnc" id="L768" title="All 4 branches missed.">        if(playerIndex == model.getCurrentPlayer() &amp;&amp; model.getCurrentPhase().ordinal() &lt;= GamePhase.MoveMotherNature.ordinal()){</span>
<span class="nc bnc" id="L769" title="All 2 branches missed.">            for (CharacterCard c: model.getGameBoard().getThreeCharacterCards()){</span>
<span class="nc bnc" id="L770" title="All 4 branches missed.">                if(cardIndex == c.getIndex() &amp;&amp; model.getPlayers().get(playerIndex).getCoins() &gt;= c.getCost()){</span>
<span class="nc" id="L771">                    System.out.println(&quot;STAI GIOCANDO LA CARTA 9&quot;);</span>
<span class="nc" id="L772">                    model.getPlayers().get(playerIndex).removeCoin(c.getCost());</span>
<span class="nc" id="L773">                    model.getGameBoard().addCoinsToGeneralReserve(c.getCost() - 1);</span>
<span class="nc" id="L774">                    c.play();</span>

<span class="nc" id="L776">                    ((Character9) c).enableEffect(colorIndex);</span>
<span class="nc" id="L777">                    return 1;</span>
                }
<span class="nc" id="L779">            }</span>
        }
<span class="nc" id="L781">        return -1;</span>
    }

    public int playCharacterCard10(int playerIndex, int cardIndex, int entranceStudent1, int diningStudent1){

<span class="nc bnc" id="L786" title="All 4 branches missed.">        if(playerIndex == model.getCurrentPlayer() &amp;&amp; model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getDiningRoom().numOfStudentByColor(Colour.values()[diningStudent1]) &gt; 0){</span>
<span class="nc" id="L787">            boolean checkStudentColor = false; // vedo se ha lo studente di quel colore</span>
<span class="nc bnc" id="L788" title="All 2 branches missed.">            for (Student s : model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getStudentsEntrance())</span>
<span class="nc bnc" id="L789" title="All 2 branches missed.">                if (Colour.values()[entranceStudent1] == s.getColour()) {</span>
<span class="nc" id="L790">                    checkStudentColor = true;</span>
<span class="nc" id="L791">                    break;</span>
                }

<span class="nc bnc" id="L794" title="All 2 branches missed.">            if(checkStudentColor){</span>
<span class="nc bnc" id="L795" title="All 2 branches missed.">                for (CharacterCard c: model.getGameBoard().getThreeCharacterCards()){</span>
<span class="nc bnc" id="L796" title="All 4 branches missed.">                    if(cardIndex == c.getIndex() &amp;&amp; model.getPlayers().get(playerIndex).getCoins() &gt;= c.getCost()){</span>
<span class="nc" id="L797">                        System.out.println(&quot;STAI GIOCANDO LA CARTA 10&quot;);</span>
<span class="nc" id="L798">                        model.getPlayers().get(playerIndex).removeCoin(c.getCost());</span>
<span class="nc" id="L799">                        model.getGameBoard().addCoinsToGeneralReserve(c.getCost() - 1);</span>
<span class="nc" id="L800">                        c.play();</span>

<span class="nc" id="L802">                        model.getPlayers().get(playerIndex).getPlayerSchoolBoard().moveStudentToDiningRoom(entranceStudent1);</span>
<span class="nc" id="L803">                        model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getDiningRoom().removeOneStudent(diningStudent1);</span>
<span class="nc" id="L804">                        model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getStudentsEntrance().add(new Student(Colour.values()[diningStudent1]));</span>

<span class="nc bnc" id="L806" title="All 2 branches missed.">                        for(Professor p: model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getProfessors())</span>
<span class="nc bnc" id="L807" title="All 2 branches missed.">                            if(p.getProfessorColour().ordinal() == diningStudent1){</span>
<span class="nc" id="L808">                                model.getPlayers().get(playerIndex).getPlayerSchoolBoard().removeProfessor(Colour.values()[diningStudent1]);</span>
<span class="nc" id="L809">                                break;</span>
                            }

<span class="nc" id="L812">                        checkProfessorProperty(entranceStudent1);</span>
<span class="nc" id="L813">                        checkProfessorProperty(diningStudent1);</span>
<span class="nc" id="L814">                        return 1;</span>
                    }
<span class="nc" id="L816">                }</span>
            }
        }
<span class="nc" id="L819">        return -1;</span>
    }

    public int playCharacterCard10(int playerIndex, int cardIndex, int entranceStudent1, int diningStudent1, int entranceStudent2, int diningStudent2){
<span class="nc" id="L823">        int sameCard = 0;</span>
<span class="nc bnc" id="L824" title="All 2 branches missed.">        if(diningStudent1 == diningStudent2)</span>
<span class="nc" id="L825">            sameCard = 1;</span>

<span class="nc bnc" id="L827" title="All 6 branches missed.">        if(playerIndex == model.getCurrentPlayer() &amp;&amp; model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getDiningRoom().numOfStudentByColor(Colour.values()[diningStudent1]) &gt; sameCard &amp;&amp; model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getDiningRoom().numOfStudentByColor(Colour.values()[diningStudent2]) &gt; sameCard){</span>
<span class="nc" id="L828">            int checkStudentColor = 0; // vedo se ha lo studente di quel colore</span>
<span class="nc" id="L829">            int checkStudentColor2 = 0;</span>
<span class="nc bnc" id="L830" title="All 2 branches missed.">            for (Student s : model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getStudentsEntrance()){</span>
<span class="nc bnc" id="L831" title="All 2 branches missed.">                if (Colour.values()[entranceStudent1] == s.getColour())</span>
<span class="nc" id="L832">                    checkStudentColor++;</span>
<span class="nc bnc" id="L833" title="All 2 branches missed.">                if (Colour.values()[entranceStudent2] == s.getColour())</span>
<span class="nc" id="L834">                    checkStudentColor2++;</span>
<span class="nc" id="L835">            }</span>

<span class="nc" id="L837">            sameCard = 0;</span>
<span class="nc bnc" id="L838" title="All 2 branches missed.">            if(entranceStudent1 == entranceStudent2)</span>
<span class="nc" id="L839">                sameCard = 1;</span>
<span class="nc bnc" id="L840" title="All 4 branches missed.">            if(checkStudentColor &gt; sameCard &amp;&amp; checkStudentColor2 &gt; sameCard){</span>
<span class="nc bnc" id="L841" title="All 2 branches missed.">                for (CharacterCard c: model.getGameBoard().getThreeCharacterCards()){</span>
<span class="nc bnc" id="L842" title="All 4 branches missed.">                    if(cardIndex == c.getIndex() &amp;&amp; model.getPlayers().get(playerIndex).getCoins() &gt;= c.getCost()){</span>
<span class="nc" id="L843">                        System.out.println(&quot;STAI GIOCANDO LA CARTA 10&quot;);</span>
<span class="nc" id="L844">                        model.getPlayers().get(playerIndex).removeCoin(c.getCost());</span>
<span class="nc" id="L845">                        model.getGameBoard().addCoinsToGeneralReserve(c.getCost() - 1);</span>
<span class="nc" id="L846">                        c.play();</span>

<span class="nc" id="L848">                        model.getPlayers().get(playerIndex).getPlayerSchoolBoard().moveStudentToDiningRoom(entranceStudent1);</span>
<span class="nc" id="L849">                        model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getDiningRoom().removeOneStudent(diningStudent1);</span>
<span class="nc" id="L850">                        model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getStudentsEntrance().add(new Student(Colour.values()[diningStudent1]));</span>

<span class="nc bnc" id="L852" title="All 2 branches missed.">                        for(Professor p: model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getProfessors())</span>
<span class="nc bnc" id="L853" title="All 2 branches missed.">                            if(p.getProfessorColour().ordinal() == diningStudent1){</span>
<span class="nc" id="L854">                                model.getPlayers().get(playerIndex).getPlayerSchoolBoard().removeProfessor(Colour.values()[diningStudent1]);</span>
<span class="nc" id="L855">                                break;</span>
                            }

<span class="nc" id="L858">                        checkProfessorProperty(entranceStudent1);</span>
<span class="nc" id="L859">                        checkProfessorProperty(diningStudent1);</span>

<span class="nc" id="L861">                        model.getPlayers().get(playerIndex).getPlayerSchoolBoard().moveStudentToDiningRoom(entranceStudent2);</span>
<span class="nc" id="L862">                        model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getDiningRoom().removeOneStudent(diningStudent2);</span>
<span class="nc" id="L863">                        model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getStudentsEntrance().add(new Student(Colour.values()[diningStudent2]));</span>

<span class="nc bnc" id="L865" title="All 2 branches missed.">                        for(Professor p: model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getProfessors())</span>
<span class="nc bnc" id="L866" title="All 2 branches missed.">                            if(p.getProfessorColour().ordinal() == diningStudent2){</span>
<span class="nc" id="L867">                                model.getPlayers().get(playerIndex).getPlayerSchoolBoard().removeProfessor(Colour.values()[diningStudent2]);</span>
<span class="nc" id="L868">                                break;</span>
                            }

<span class="nc" id="L871">                        checkProfessorProperty(entranceStudent2);</span>
<span class="nc" id="L872">                        checkProfessorProperty(diningStudent2);</span>
<span class="nc" id="L873">                        return 1;</span>
                    }
<span class="nc" id="L875">                }</span>
            }
        }
<span class="nc" id="L878">        return -1;</span>
    }



    public int playCharacterCard11(int playerIndex, int cardIndex, int colorIndex){
<span class="nc bnc" id="L884" title="All 2 branches missed.">        if(playerIndex == model.getCurrentPlayer()){</span>
<span class="nc bnc" id="L885" title="All 2 branches missed.">            for (CharacterCard c: model.getGameBoard().getThreeCharacterCards()){</span>
<span class="nc bnc" id="L886" title="All 6 branches missed.">                if(cardIndex == c.getIndex() &amp;&amp; model.getPlayers().get(playerIndex).getCoins() &gt;= c.getCost() &amp;&amp; ((Character11) c).checkColorExists(colorIndex)){</span>
<span class="nc" id="L887">                    System.out.println(&quot;STAI GIOCANDO LA CARTA 11&quot;);</span>
<span class="nc" id="L888">                    model.getPlayers().get(playerIndex).removeCoin(c.getCost());</span>
<span class="nc" id="L889">                    model.getGameBoard().addCoinsToGeneralReserve(c.getCost() - 1);</span>
<span class="nc" id="L890">                    c.play();</span>

                    boolean coin; //ritorna true se il giocatore merita una moneta
<span class="nc" id="L893">                    coin = model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getDiningRoom().addStudent(((Character11) c).getStudent(colorIndex));</span>
<span class="nc bnc" id="L894" title="All 4 branches missed.">                    if (Parameters.expertMode &amp;&amp; coin)</span>
<span class="nc bnc" id="L895" title="All 2 branches missed.">                        if(model.getGameBoard().getOneCoin())</span>
<span class="nc" id="L896">                            model.getPlayers().get(playerIndex).addCoin();</span>


                    //controllo chi possiede il professore ora
<span class="nc" id="L900">                    checkProfessorProperty(colorIndex);</span>

<span class="nc" id="L902">                    ((Character11) c).addStudent(model.getGameBoard().getBag().draw());</span>
<span class="nc" id="L903">                    return 1;</span>
                }
<span class="nc" id="L905">            }</span>
        }
<span class="nc" id="L907">        return -1;</span>
    }

    public int playCharacterCard12(int playerIndex, int cardIndex, int colorIndex){
<span class="nc bnc" id="L911" title="All 2 branches missed.">        if(playerIndex == model.getCurrentPlayer()){</span>
<span class="nc bnc" id="L912" title="All 2 branches missed.">            for (CharacterCard c: model.getGameBoard().getThreeCharacterCards()){</span>
<span class="nc bnc" id="L913" title="All 4 branches missed.">                if(cardIndex == c.getIndex() &amp;&amp; model.getPlayers().get(playerIndex).getCoins() &gt;= c.getCost()){</span>
<span class="nc" id="L914">                    System.out.println(&quot;STAI GIOCANDO LA CARTA 12&quot;);</span>
<span class="nc" id="L915">                    model.getPlayers().get(playerIndex).removeCoin(c.getCost());</span>
<span class="nc" id="L916">                    model.getGameBoard().addCoinsToGeneralReserve(c.getCost() - 1);</span>
<span class="nc" id="L917">                    c.play();</span>

<span class="nc bnc" id="L919" title="All 2 branches missed.">                    for (Player p: model.getPlayers())</span>
<span class="nc" id="L920">                        model.getGameBoard().getBag().fill(p.getPlayerSchoolBoard().getDiningRoom().removeThreeStudents(Colour.values()[colorIndex]));</span>

                    //controllo chi possiede il professore ora
<span class="nc" id="L923">                    checkProfessorProperty(colorIndex);</span>

<span class="nc" id="L925">                    return 1;</span>
                }
<span class="nc" id="L927">            }</span>
        }
<span class="nc" id="L929">        return -1;</span>
    }

    public int playCharacterCard7(int playerIndex, int cardIndex, int cardStudent1, int entranceStudent1){
<span class="nc bnc" id="L933" title="All 2 branches missed.">        if(playerIndex == model.getCurrentPlayer()){</span>
<span class="nc bnc" id="L934" title="All 2 branches missed.">            for (CharacterCard c: model.getGameBoard().getThreeCharacterCards()){</span>
<span class="nc bnc" id="L935" title="All 6 branches missed.">                if(cardIndex == c.getIndex() &amp;&amp; model.getPlayers().get(playerIndex).getCoins() &gt;= c.getCost() &amp;&amp; ((Character7) c).checkColorExists(cardStudent1)){</span>
                    //controllo se i tre studenti del suo ingresso sono giusti
<span class="nc" id="L937">                    boolean check1 = false;</span>
<span class="nc bnc" id="L938" title="All 2 branches missed.">                    for(Student s: model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getStudentsEntrance()){</span>
<span class="nc bnc" id="L939" title="All 4 branches missed.">                        if(entranceStudent1 == s.getColour().ordinal() &amp;&amp; entranceStudent1 &lt; 5)</span>
<span class="nc" id="L940">                            check1 = true;</span>
<span class="nc" id="L941">                    }</span>
<span class="nc bnc" id="L942" title="All 2 branches missed.">                    if(!check1)</span>
<span class="nc" id="L943">                        return -1;</span>

<span class="nc" id="L945">                    System.out.println(&quot;STAI GIOCANDO LA CARTA 7&quot;);</span>
<span class="nc" id="L946">                    model.getPlayers().get(playerIndex).removeCoin(c.getCost());</span>
<span class="nc" id="L947">                    model.getGameBoard().addCoinsToGeneralReserve(c.getCost() - 1); //meno uno perchè una va sulla carta</span>
<span class="nc" id="L948">                    c.play();</span>

<span class="nc" id="L950">                    model.getPlayers().get(playerIndex).getPlayerSchoolBoard().removeStudentFromEntrance(entranceStudent1);</span>
<span class="nc" id="L951">                    model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getStudentsEntrance().add(((Character7) c).getStudent(cardStudent1));</span>
<span class="nc" id="L952">                    ((Character7) c).addStudent(new Student(Colour.values()[entranceStudent1]));</span>
<span class="nc" id="L953">                    return 1;</span>
                }
<span class="nc" id="L955">            }</span>
        }
<span class="nc" id="L957">        return -1;</span>
    }

    public int playCharacterCard7(int playerIndex, int cardIndex, int cardStudent1, int entranceStudent1, int cardStudent2, int entranceStudent2){
<span class="nc bnc" id="L961" title="All 2 branches missed.">        if(playerIndex == model.getCurrentPlayer()){</span>
<span class="nc bnc" id="L962" title="All 2 branches missed.">            for (CharacterCard c: model.getGameBoard().getThreeCharacterCards()){</span>
<span class="nc bnc" id="L963" title="All 8 branches missed.">                if(cardIndex == c.getIndex() &amp;&amp; model.getPlayers().get(playerIndex).getCoins() &gt;= c.getCost() &amp;&amp; ((Character7) c).checkColorExists(cardStudent1) &amp;&amp; ((Character7) c).checkColorExists(cardStudent2)){</span>
                    //controllo se i due studenti del suo ingresso sono giusti
<span class="nc" id="L965">                    boolean check1 = false;</span>
<span class="nc" id="L966">                    boolean check2 = false;</span>
<span class="nc bnc" id="L967" title="All 2 branches missed.">                    for(Student s: model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getStudentsEntrance()){</span>
<span class="nc bnc" id="L968" title="All 4 branches missed.">                        if(entranceStudent1 == s.getColour().ordinal() &amp;&amp; entranceStudent1 &lt; 5)</span>
<span class="nc" id="L969">                            check1 = true;</span>
<span class="nc bnc" id="L970" title="All 4 branches missed.">                        else if(entranceStudent2 != s.getColour().ordinal() &amp;&amp; entranceStudent1 &lt; 5)</span>
<span class="nc" id="L971">                            check2 = true;</span>
<span class="nc" id="L972">                    }</span>
<span class="nc bnc" id="L973" title="All 4 branches missed.">                    if(!(check1 &amp;&amp; check2))</span>
<span class="nc" id="L974">                        return -1;</span>

<span class="nc" id="L976">                    System.out.println(&quot;STAI GIOCANDO LA CARTA 7&quot;);</span>
<span class="nc" id="L977">                    model.getPlayers().get(playerIndex).removeCoin(c.getCost());</span>
<span class="nc" id="L978">                    model.getGameBoard().addCoinsToGeneralReserve(c.getCost() - 1); //meno uno perchè una va sulla carta</span>
<span class="nc" id="L979">                    c.play();</span>

<span class="nc" id="L981">                    model.getPlayers().get(playerIndex).getPlayerSchoolBoard().removeStudentFromEntrance(entranceStudent1);</span>
<span class="nc" id="L982">                    model.getPlayers().get(playerIndex).getPlayerSchoolBoard().removeStudentFromEntrance(entranceStudent2);</span>

<span class="nc" id="L984">                    model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getStudentsEntrance().add(((Character7) c).getStudent(cardStudent1));</span>
<span class="nc" id="L985">                    model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getStudentsEntrance().add(((Character7) c).getStudent(cardStudent2));</span>

<span class="nc" id="L987">                    ((Character7) c).addStudent(new Student(Colour.values()[entranceStudent1]));</span>
<span class="nc" id="L988">                    ((Character7) c).addStudent(new Student(Colour.values()[entranceStudent2]));</span>
<span class="nc" id="L989">                    return 1;</span>
                }
<span class="nc" id="L991">            }</span>
        }
<span class="nc" id="L993">        return -1;</span>
    }


    public int playCharacterCard7(int playerIndex, int cardIndex, int cardStudent1, int entranceStudent1, int cardStudent2, int entranceStudent2, int cardStudent3, int entranceStudent3){
<span class="nc bnc" id="L998" title="All 2 branches missed.">        if(playerIndex == model.getCurrentPlayer()){</span>
<span class="nc bnc" id="L999" title="All 2 branches missed.">            for (CharacterCard c: model.getGameBoard().getThreeCharacterCards()){</span>
<span class="nc bnc" id="L1000" title="All 10 branches missed.">                if(cardIndex == c.getIndex() &amp;&amp; model.getPlayers().get(playerIndex).getCoins() &gt;= c.getCost() &amp;&amp; ((Character7) c).checkColorExists(cardStudent1) &amp;&amp; ((Character7) c).checkColorExists(cardStudent2) &amp;&amp; ((Character7) c).checkColorExists(cardStudent3)){</span>
                    //controllo se i tre studenti del suo ingresso sono giusti
<span class="nc" id="L1002">                    boolean check1 = false;</span>
<span class="nc" id="L1003">                    boolean check2 = false;</span>
<span class="nc" id="L1004">                    boolean check3 = false;</span>
<span class="nc bnc" id="L1005" title="All 2 branches missed.">                    for(Student s: model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getStudentsEntrance()){</span>
<span class="nc bnc" id="L1006" title="All 4 branches missed.">                        if(entranceStudent1 == s.getColour().ordinal() &amp;&amp; entranceStudent1 &lt; 5)</span>
<span class="nc" id="L1007">                            check1 = true;</span>
<span class="nc bnc" id="L1008" title="All 4 branches missed.">                        else if(entranceStudent2 != s.getColour().ordinal() &amp;&amp; entranceStudent1 &lt; 5)</span>
<span class="nc" id="L1009">                            check2 = true;</span>
<span class="nc bnc" id="L1010" title="All 4 branches missed.">                        else if(entranceStudent3 != s.getColour().ordinal() &amp;&amp; entranceStudent1 &lt; 5)</span>
<span class="nc" id="L1011">                            check3 = true;</span>
<span class="nc" id="L1012">                    }</span>
<span class="nc bnc" id="L1013" title="All 6 branches missed.">                    if(!(check1 &amp;&amp; check2 &amp;&amp; check3))</span>
<span class="nc" id="L1014">                        return -1;</span>

<span class="nc" id="L1016">                    System.out.println(&quot;STAI GIOCANDO LA CARTA 7&quot;);</span>
<span class="nc" id="L1017">                    model.getPlayers().get(playerIndex).removeCoin(c.getCost());</span>
<span class="nc" id="L1018">                    model.getGameBoard().addCoinsToGeneralReserve(c.getCost() - 1); //meno uno perchè una va sulla carta</span>
<span class="nc" id="L1019">                    c.play();</span>

<span class="nc" id="L1021">                    model.getPlayers().get(playerIndex).getPlayerSchoolBoard().removeStudentFromEntrance(entranceStudent1);</span>
<span class="nc" id="L1022">                    model.getPlayers().get(playerIndex).getPlayerSchoolBoard().removeStudentFromEntrance(entranceStudent2);</span>
<span class="nc" id="L1023">                    model.getPlayers().get(playerIndex).getPlayerSchoolBoard().removeStudentFromEntrance(entranceStudent3);</span>

<span class="nc" id="L1025">                    model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getStudentsEntrance().add(((Character7) c).getStudent(cardStudent1));</span>
<span class="nc" id="L1026">                    model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getStudentsEntrance().add(((Character7) c).getStudent(cardStudent2));</span>
<span class="nc" id="L1027">                    model.getPlayers().get(playerIndex).getPlayerSchoolBoard().getStudentsEntrance().add(((Character7) c).getStudent(cardStudent3));</span>

<span class="nc" id="L1029">                    ((Character7) c).addStudent(new Student(Colour.values()[entranceStudent1]));</span>
<span class="nc" id="L1030">                    ((Character7) c).addStudent(new Student(Colour.values()[entranceStudent2]));</span>
<span class="nc" id="L1031">                    ((Character7) c).addStudent(new Student(Colour.values()[entranceStudent3]));</span>
<span class="nc" id="L1032">                    return 1;</span>
                }
<span class="nc" id="L1034">            }</span>
        }
<span class="nc" id="L1036">        return -1;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>